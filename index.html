<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemical Calculator</title>
</head>
<body>
    <h1>Chemical Calculation</h1>
    Desired Concentration: <input type="number" id="concentration" step="any">
    <select id="concentration_unit">
        <option value="M">M</option>
        <option value="mM">mM</option>
        <option value="μM">μM</option>
    </select><br>
    Molar Mass (g/mol): <input type="number" id="molar_mass" step="any"><br>
    Volume: <input type="number" id="volume" step="any">
    <select id="volume_unit">
        <option value="L">L</option>
        <option value="mL">mL</option>
        <option value="μL">μL</option>
    </select><br>
    <button onclick="calculateMass()">Calculate</button>

    <h2>Results</h2>
    <p>Required mass of the chemical: <span id="required_mass"></span></p>
    <p><span id="advice"></span></p>

    <script>
        function toSignificantFigures(num, n) {
            if (num === 0) return 0;
            let d = Math.ceil(Math.log10(num < 0 ? -num : num));
            let power = n - d;
            let magnitude = Math.pow(10, power);
            let shifted = Math.round(num * magnitude);
            return shifted / magnitude;
        }

        function convertConcentrationToMoles(concentration, unit) {
            if (unit === "M") return concentration;
            else if (unit === "mM") return concentration / 1000;
            else if (unit === "μM") return concentration / 1000000;
        }

        function convertVolumeToLiters(volume, unit) {
            if (unit === "L") return volume;
            else if (unit === "mL") return volume / 1000;
            else if (unit === "μL") return volume / 1000000;
        }

        function calculateMass() {
            var concentration = parseFloat(document.getElementById('concentration').value);
            var concentrationUnit = document.getElementById('concentration_unit').value;
            var molarMass = parseFloat(document.getElementById('molar_mass').value);
            var volume = parseFloat(document.getElementById('volume').value);
            var volumeUnit = document.getElementById('volume_unit').value;

            var moles = convertConcentrationToMoles(concentration, concentrationUnit);
            var liters = convertVolumeToLiters(volume, volumeUnit);
            var requiredMass = moles * molarMass * liters; // mass in grams

            document.getElementById('required_mass').innerText = toSignificantFigures(requiredMass, 3) + " g";

            var advice = "";
            if (requiredMass < 0.01) {
                var stockVolumeNeeded = requiredMass / (1 * molarMass) * 1000; // volume in mL needed from a 1 M solution
                advice = `For precise measurement, prepare a 1 M stock solution by dissolving ${toSignificantFigures(molarMass, 3)} g of the chemical in enough water to make 1 L of solution. Then dilute ${toSignificantFigures(stockVolumeNeeded, 3)} mL of this stock solution into ${toSignificantFigures(liters * 1000, 3)} mL to achieve the desired concentration of ${toSignificantFigures(concentration, 3)} ${concentrationUnit}.`;
            } else {
                advice = "Weigh out the required mass directly.";
            }
            document.getElementById('advice').innerText = advice;
        }
    </script>
</body>
</html>
